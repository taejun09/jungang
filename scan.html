<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR ì½”ë“œ ìŠ¤ìº”</title>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            text-align: center;
            padding: 20px;
        }
        .qr-container {
            margin-top: 20px;
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #1F1F1F, #2A2A2A);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            display: inline-block;
            width: 90%;
            max-width: 500px;
        }
        .status {
            margin-top: 15px;
            font-size: 16px;
            font-weight: bold;
            color: #acff8c;
        }
    </style>
</head>
<body>

    <h2>QR ì½”ë“œ ìŠ¤ìº”</h2>
    <p>QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì—¬ ì¸ì¦ì„ ì§„í–‰í•˜ì„¸ìš”.</p>
    
    <div id="qr-reader" class="qr-container"></div>

    <p id="status" class="status">ğŸ”„ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”...</p>
    
    <script>
        function onScanSuccess(decodedText, decodedResult) {
            // QR ì½”ë“œì—ì„œ ì–»ì€ URLì„ íŒŒì‹±í•˜ì—¬ í•™ìƒì¦ ì¸ì¦ í˜ì´ì§€ë¡œ ì´ë™
            const urlParams = new URLSearchParams(decodedText.split('?')[1]);
            const studentID = urlParams.get("studentID");

            if (studentID) {
                document.getElementById("status").innerText = `âœ… í•™ë²ˆ: ${studentID} ì¸ì¦ ì¤‘...`;

                // ì¸ì¦ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = `verify.html?studentID=${studentID}`;
            } else {
                document.getElementById("status").innerText = "âŒ ìœ íš¨í•˜ì§€ ì•Šì€ QR ì½”ë“œì…ë‹ˆë‹¤.";
            }
        }

        function onScanError(errorMessage) {
            // ì˜¤ë¥˜ ë°œìƒ ì‹œ
            console.log("QR ì½”ë“œ ìŠ¤ìº” ì˜¤ë¥˜:", errorMessage);
        }

        // QR ì½”ë“œ ìŠ¤ìº”ì„ ì‹œì‘í•©ë‹ˆë‹¤.
        const html5QrCode = new Html5Qrcode("qr-reader");

        html5QrCode.start(
            { facingMode: "environment" }, // ì¹´ë©”ë¼ ì‚¬ìš© ì„¤ì •
            {
                fps: 10,    // ì´ˆë‹¹ 10í”„ë ˆì„ìœ¼ë¡œ ìŠ¤ìº”
                qrbox: { width: 250, height: 250 }  // QR ì½”ë“œì˜ í¬ê¸° ì„¤ì •
            },
            onScanSuccess,
            onScanError
        );
    </script>

</body>
</html>
